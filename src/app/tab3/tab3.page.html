<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-button slot="start" fill="clear" (click)="volverAPaso1()">
      <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
    </ion-button>
    <ion-title>Registrar Lectura - Paso 2</ion-title>
    <ion-button slot="end" color="danger" (click)="confirmarCerrarSesion()">
      <ion-icon slot="icon-only" name="log-out"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <div class="content-wrapper">
    <!-- Información del usuario -->
    <ion-card class="user-info">
      <ion-card-content>
        <ion-text color="medium">
          <p><strong>Usuario:</strong> {{ userEmail }}</p>
          <p><strong>Paso 2:</strong> Valor del medidor, observaciones y foto de fachada</p>
        </ion-text>
      </ion-card-content>
    </ion-card>

    <!-- Resumen del Paso 1 -->
    <ion-card color="light">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="checkmark-circle" color="success"></ion-icon>
          Datos del Paso 1
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <div class="preview-small">
                <p><strong>Foto Medidor:</strong></p>
                <ion-img [src]="lectura.foto_medidor"></ion-img>
              </div>
            </ion-col>
            <ion-col size="6">
              <ion-text color="medium">
                <p><strong>Ubicación GPS:</strong></p>
                <p>Lat: {{ lectura.latitud?.toFixed(4) }}</p>
                <p>Lng: {{ lectura.longitud?.toFixed(4) }}</p>
              </ion-text>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <!-- Valor del Medidor -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="speedometer" color="primary"></ion-icon>
          Valor del Medidor
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label position="floating">Valor en kWh *</ion-label>
          <ion-input 
            type="number" 
            [(ngModel)]="lectura.valor_medidor"
            placeholder="Ejemplo: 12345"
            min="0"
          ></ion-input>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Observaciones -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="document-text" color="primary"></ion-icon>
          Observaciones
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label position="floating">Observaciones (opcional)</ion-label>
          <ion-textarea 
            [(ngModel)]="lectura.observaciones"
            rows="4"
            placeholder="Agrega cualquier observación relevante sobre la lectura..."
          ></ion-textarea>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Foto de la Fachada -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="home" color="primary"></ion-icon>
          Fotografía de la Fachada
        </ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-button 
          expand="block" 
          (click)="seleccionarFotoFachada()"
          [color]="lectura.foto_fachada ? 'success' : 'primary'"
        >
          <ion-icon slot="start" name="camera"></ion-icon>
          {{ lectura.foto_fachada ? 'Cambiar Foto' : 'Tomar Foto de la Fachada' }}
        </ion-button>

        <div *ngIf="lectura.foto_fachada" class="preview-container ion-margin-top">
          <ion-img [src]="lectura.foto_fachada"></ion-img>
          <ion-icon name="checkmark-circle" color="success" class="check-icon"></ion-icon>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Instrucciones -->
    <ion-card color="light">
      <ion-card-content>
        <ion-text color="medium">
          <p><strong>Instrucciones:</strong></p>
          <p>1. Ingresa el valor exacto del medidor</p>
          <p>2. Agrega observaciones si es necesario</p>
          <p>3. Toma una foto de la fachada de la casa</p>
          <p>4. Guarda la lectura completa</p>
        </ion-text>
      </ion-card-content>
    </ion-card>

    <!-- Botones de Acción -->
    <ion-grid>
      <ion-row>
        <ion-col size="12">
          <ion-button 
            expand="block" 
            color="success" 
            size="large"
            (click)="guardarLectura()"
          >
            <ion-icon slot="start" name="save"></ion-icon>
            Guardar Lectura Completa
          </ion-button>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col size="12">
          <ion-button 
            expand="block" 
            fill="outline"
            color="medium"
            (click)="volverAPaso1()"
          >
            <ion-icon slot="start" name="arrow-back"></ion-icon>
            Volver al Paso 1
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
</ion-content>